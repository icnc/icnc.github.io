<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>CnC: Tag-Ranges</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">CnC
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Tag-Ranges </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Often the natural granularity of a step is rather small in the sense of having only low compute load. As the <a class="el" href="namespace_cn_c.html" title="CnC API.">CnC</a> convenience of programming with <a class="el" href="namespace_cn_c.html" title="CnC API.">CnC</a> (e.g. all the automatic parallelism) apparently comes with some overhead, this might not always lead to an efficient program. The <a class="el" href="namespace_cn_c.html" title="CnC API.">CnC</a> C++ API comes with a possibility to prescribe a bunch of tags at once. This feature is closely related to TBB's range concept. Like in TBB, the put range will be subject to recursive splitting/partitioning. Instead of scheduling individual tags, the runtime will then schedule entire ranges and so avoid some overhead induced by the scheduler. Major differences to TBB's range concept are firstly that <a class="el" href="namespace_cn_c.html" title="CnC API.">CnC</a> doesn't really treat it as a consecutive range but only as an iteratable set, and secondly that the interface to steps stays at the granularity of individual tags. There is only one interface to steps, e.g. you still define the execute method on tags (and not on tag-ranges) which allows for mixing puts of tags and tag-ranges within the same program.</p>
<p>In the primes example (/samples/primes/primes) we actually put a series of tags to trigger the graph evaluation. Let's use tag-ranges instead; it will give the runtime more freedom for optimization and some might even think it's nicer code. Primarily, tag-ranges as seen as a tuning capability so most of the functionality is within the tuning interface, e.g. in the tag-tuner.</p>
<p>First of all we have to declare the type of range we are going to use. All we need is a blocked range of integers, so let's just use TBB's blocked range. The range-type is declared through a tuner; the tag-tuner interface accepts the range type as its first template argument. As we are not going to provide any custom code, we can just use the <a class="el" href="namespace_cn_c.html" title="CnC API.">CnC</a> tuner-class directly:  <div class="fragment"><pre class="fragment">    <a class="code" href="class_cn_c_1_1tag__collection.html" title="A tag collection is a set of tags of the same type. It is used to prescribe steps. By default, tags are not stored.">CnC::tag_collection&lt; int, CnC::tag_tuner&lt; CnC::Internal::strided_range&lt; int &gt;</a> &gt; &gt; m_tags;
</pre></div></p>
<p>Now we can put the range instead of writing a for-loop (in main): <div class="fragment"><pre class="fragment">    c.m_tags.put_range( CnC::Internal::strided_range&lt; int &gt;( 3, n, 2 ) );
</pre></div></p>
<p>If you run and compile this code (<a class="el" href="samples.html#primes_range_code">samples/primes/primes_range/primes_range.cpp</a>) you should observe from the scheduler statistics output that the number of scheduled steps is significantly smaller than the number of checked values. Please note that for this algorithm a more sophisticated partitioning strategy would be needed to achieve good scalability. The default partitioning creates equally sized ranges, which will lead to heavier partitions if the tag-values become bigger. Please refer to <a class="el" href="tag_ranges.html#tag_range_adv">Advanced Range-Features</a> for more details on the partitioner interface.</p>
<h2><a class="anchor" id="parfor"></a>
CnC::parallel_for</h2>
<p>The above example checks twice as many values necessary, as it does execute the step also for even numbers. To avoid this, you can define your own range, which could for example use strides or list odd numbers in any other manner (see <a class="el" href="tag_ranges.html#tag_range_adv">Advanced Range-Features</a>). Alternatively you can use the convenient parallel_for construct. Besides avoiding unnecessary work, it even simplifies the code: You don't need a tag-collection and instead of prescribing a step you simply apply the step to parallel_for:  <div class="fragment"><pre class="fragment">    <a class="code" href="namespace_cn_c.html#ae3c2dbac829e8845b8608fae7bdf41a8" title="Execute f( i ) for every i in {first &lt;= i=first+step*x &lt; last and 0 &lt;= x}.">CnC::parallel_for</a>( 3, n+1, 2, FindPrimes(), <a class="code" href="struct_cn_c_1_1pfor__tuner.html" title="Default (NOP) implementations of the pfor_tuner interface.">CnC::pfor_tuner&lt; false &gt;</a>() );
</pre></div> The last argument "false" is a tuning parameter (see <a class="el" href="tag_ranges.html#tune_ranges">Tuning Ranges</a>) which tells the runtime that the step-code will not get any items (e.g. is independent of any other steps or items).See <a class="el" href="samples.html#primes_parfor_code">samples/primes/primes_parfor/primes_parfor.cpp</a> for the full code.</p>
<dl class="attention"><dt><b>Attention:</b></dt><dd>In distributed mode, parallel_for will not distribute the given work across processes even if the tuner provides a matching compute_on function. All implied steps-instances will always be scheduled locally.</dd></dl>
<h2><a class="anchor" id="tune_ranges"></a>
Tuning Ranges</h2>
<p>If you do use ranges or <a class="el" href="namespace_cn_c.html#ae3c2dbac829e8845b8608fae7bdf41a8" title="Execute f( i ) for every i in {first &lt;= i=first+step*x &lt; last and 0 &lt;= x}.">CnC::parallel_for</a> and the step-code does not consume items, you can bypass overhead which is needed to handle data dependencies. The optional template parameter to step_tuner allows this in a very simple manner by setting it to "false": </p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>my_step_tuner : <span class="keyword">public</span> CnC::step_tuner&lt; false &gt;
  { ... }
</pre></div><p>A even more simplified version of this parameter is used in <a class="el" href="namespace_cn_c.html#ae3c2dbac829e8845b8608fae7bdf41a8" title="Execute f( i ) for every i in {first &lt;= i=first+step*x &lt; last and 0 &lt;= x}.">CnC::parallel_for</a> and CnC::context::parallel_for, e.g in this example: <a class="el" href="tag_ranges.html#parfor">CnC::parallel_for</a>.</p>
<p>As mentioned in <a class="el" href="tag_ranges.html">Tag-Ranges</a> the tuner also provides the partitioner. Tag ranges are a matter of tag-collections, so the providing a custom partitioner is done through assigning a tuner to the tag-collection. All you need to do is provide the tuner as the second optional argument to tag_tuner (note that the tuner is needed anyway for ranges): </p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>my_tag_tuner : <span class="keyword">public</span> CnC::tag_tuner&lt; my_range_type, my_partitioner_type &gt;
  { ... }
</pre></div><h2><a class="anchor" id="tag_range_adv"></a>
Advanced Range-Features</h2>
<p>Aspects of Tag-Ranges The implemented range-mechanism is very generic. It allows you to provide an arbitrary range as long as you also provide a partitioner which can handle the partitioning of your range (which might be anything, a tree, a matrix etc.). For a detailed description on the requirements on ranges and partitioners please refer to <a class="el" href="class_cn_c_1_1tag__collection.html#a9ebc641002c9a7bd1be46972ee81ab3e" title="prescribe an entire range of tags">CnC::tag_collection::put_range</a> and <a class="el" href="class_cn_c_1_1default__partitioner.html" title="Interface for partitioners: configuring how ranges are partitioned.">CnC::default_partitioner</a>.</p>
<p>It is possible to let a step work on ranges rather than on individual tags. All you need to do is use the range for both, the tag-type and the range-type. To let the runtime use recursive partitioning you also need to provide a partitioner. The API comes with a pre-defined partitioner for this: <a class="el" href="class_cn_c_1_1tag__partitioner.html">CnC::tag_partitioner</a> which is otherwise identical to the <a class="el" href="class_cn_c_1_1default__partitioner.html" title="Interface for partitioners: configuring how ranges are partitioned.">CnC::default_partitioner</a>. Note: if your tag-type is a range, using <a class="el" href="class_cn_c_1_1tag__collection.html#a38ba4c8b5f8970af78e4475efaa88745" title="prescribe the associated step. If we are preserving tags for this collection, make a copy of the tag ...">CnC::tag_collection::put</a> will not partition the range, only <a class="el" href="class_cn_c_1_1tag__collection.html#a9ebc641002c9a7bd1be46972ee81ab3e" title="prescribe an entire range of tags">CnC::tag_collection::put_range</a> will do so.</p>
<p>Partitioners are declared through providing a tuner at step-prescription time. Please read <a class="el" href="struct_cn_c_1_1tag__tuner.html" title="Default implementations of the tag-tuner interface for tag-collections.">CnC::tag_tuner</a>, <a class="el" href="class_cn_c_1_1default__partitioner.html" title="Interface for partitioners: configuring how ranges are partitioned.">CnC::default_partitioner</a> and <a class="el" href="tuning.html">The Tuners</a> for more details.</p>
<p>Next: <a class="el" href="reuse.html">Re-using CnC graphs (reductions, cross/join...)</a> </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 6 2014 15:18:33 for CnC by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
